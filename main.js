(()=>{"use strict";class t{constructor(t){this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._closeBtn=this._popup.querySelector(".popup__close-button"),this.setEventListeners()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._closeBtn.addEventListener("click",(()=>this.close())),this._popup.addEventListener("click",(t=>{t.target.classList.contains("popup")&&this.close()}))}_handleEscClose(t){"Escape"===t.key&&this.close()}}class e extends t{constructor(t,e,s){super(t),this._formSubmitHandler=e,this._formValidator=s,this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector('button[type="submit"]')}open(t){this._submitButton.textContent="Сохранить",super.open(),this._setInputValues(t),this._formValidator.resetValidation()}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent="Сохранение...",this._formSubmitHandler(this._getInputValues()).then((()=>{this.close()}))}))}_getInputValues(){var t=new FormData(this._form);return Object.fromEntries(t)}_setInputValues(t){Object.keys(t).forEach((e=>{var s=this._form.querySelector(`input[name="${e}"]`);s&&(s.value=t[e])}))}}var s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},r=document.querySelector(".profile__edit-button"),i=document.querySelector(".profile__add-button");class n{constructor(t,e){this._obj=t,this._formElement=e,this.enableValidation()}enableValidation(){this._inputList=Array.from(this._formElement.querySelectorAll(this._obj.inputSelector)),this._buttonSubmit=this._formElement.querySelector(this._obj.submitButtonSelector),this._setEventListeners(),this._toggleButtonState()}resetValidation(){this._toggleButtonState(),this._inputList.forEach((t=>{this._hideInputError(t)}))}_setEventListeners(){this._formElement.addEventListener("submit",(t=>{t.preventDefault()})),this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._inputCheck(t)}))}))}_toggleButtonState(){this._inputList.forEach((t=>{this._hasInvalidInput(t)||""===t.value?(this._buttonSubmit.classList.add(this._obj.inactiveButtonClass),this._buttonSubmit.setAttribute("disabled","true")):(this._buttonSubmit.classList.remove(this._obj.inactiveButtonClass),this._buttonSubmit.removeAttribute("disabled"))}))}_showInputError(t,e){var s=this._formElement.querySelector(`.${t.id}-error`);t.classList.add(this._obj.inputErrorClass),s.textContent=e,s.classList.add(this._obj.errorClass)}_hideInputError(t){var e=this._formElement.querySelector(`.${t.id}-error`);t.classList.remove(this._obj.inputErrorClass),e.textContent="",e.classList.remove(this._obj.errorClass)}_checkInputValidity(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}_inputCheck(t){this._checkInputValidity(t),this._toggleButtonState()}_hasInvalidInput(t){return!t.validity.valid}}class o{constructor(t,e){var s=t.items,r=t.renderer;this._items=s,this._renderer=r,this._container=document.querySelector(e)}addItem(t){this._container.prepend(t)}renderItems(){this._items.forEach((t=>{this._renderer(t)}))}}class a{constructor(t,e,s,r,i,n){this._card=e,this._myId=s,this._handleCardClick=r,this._handleCardDelete=i,this._handleCardLike=n,this._cardElement=document.querySelector(t).content.querySelector(".element").cloneNode(!0),this._cardImage=this._cardElement.querySelector(".element__image"),this._cardImage.src=this._card.link,this._cardImage.alt=this._card.name,this._cardText=this._cardElement.querySelector(".element__text"),this._cardText.textContent=this._card.name,this._cardLikes=this._cardElement.querySelector(".element__likes-amount"),this._cardLikes.textContent=this._card.likes.length.toString(),this._likeButton=this._cardElement.querySelector(".element__like-button"),this._deleteButton=this._cardElement.querySelector(".element__trash-icon"),e.likes.some((t=>t._id===s))&&this._likeButton.classList.add("element__like-button_active"),s!==e.owner._id&&this._deleteButton.remove(),this._setEventListeners()}getCard(){return this._cardElement}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>{this._deleteCard()})),this._cardImage.addEventListener("click",(()=>{this._handleCardClick()}))}_toggleLike(){this._likeButton.classList.toggle("element__like-button_active");var t=this._card.likes.some((t=>t._id===this._myId));this._handleCardLike(!t,(t=>{this._card.likes=t,this._cardLikes.textContent=t.length.toString()}))}_deleteCard(){this._handleCardDelete((()=>{this._cardElement.remove()}))}}var h,_=new class{constructor(t){this._options=t}getInitialCards(){return fetch(`${this._options.baseUrl}/cards`,{headers:this._options.headers}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}getUserInfo(){return fetch(`${this._options.baseUrl}/users/me`,{headers:this._options.headers}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}patchUserInfo(t){return fetch(`${this._options.baseUrl}/users/me`,{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:t.name,about:t.about})}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}patchAvatar(t){return fetch(`${this._options.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:t})}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}postNewCard(t,e){return fetch(`${this._options.baseUrl}/cards`,{method:"POST",headers:this._options.headers,body:JSON.stringify({name:t,link:e})}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}deleteCard(t){return fetch(`${this._options.baseUrl}/cards/${t}`,{method:"DELETE",headers:this._options.headers}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}likeCard(t,e){return fetch(`${this._options.baseUrl}/cards/${t}/likes`,{method:e?"PUT":"DELETE",headers:this._options.headers}).then((t=>t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-55",headers:{authorization:"5d6a4a95-3b77-4e4c-9a74-5ef0cb01a629","Content-Type":"application/json"}}),l=new e(".popup_edit-avatar",(t=>{var e=t.avatar;return u.setAvatar(e),_.patchAvatar(e)}),new n(s,document.forms["avatar-form"])),u=new class{constructor(t,e){this._handleAvatarEditClick=e,this._profileElement=document.querySelector(t),this._nameElement=this._profileElement.querySelector(".profile__name-text"),this._aboutElement=this._profileElement.querySelector(".profile__description"),this._profileAvatar=this._profileElement.querySelector(".profile__avatar"),this._editAvatarBtn=this._profileElement.querySelector(".profile__avatar-edit-button"),this._setEventListeners()}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._profileAvatar.src,_id:this._id}}setUserInfo(t){this._nameElement.textContent=t.name,this._aboutElement.textContent=t.about,t.avatar&&(this._profileAvatar.src=t.avatar),t._id&&(this._id=t._id)}setAvatar(t){this._profileAvatar.src=t}_setEventListeners(){this._editAvatarBtn.addEventListener("click",(()=>{this._handleAvatarEditClick(this._profileAvatar.src)}))}}(".profile",(t=>{l.open({avatar:t})})),d=document.forms["profile-form"],c=document.forms["card-form"],p=new e(".popup_edit",(function(t){return _.patchUserInfo(t).then((t=>{u.setUserInfo(t)}))}),new n(s,d)),m=new e(".popup_add",(function(t){return _.postNewCard(t["place-name"],t["image-link"]).then((t=>{h.addItem(E("#card-container",t))}))}),new n(s,c)),v=new class extends t{constructor(t){super(t),this._popupImage=this._popup.querySelector(".popup__image"),this._popupUndertext=this._popup.querySelector(".popup__undertext")}open(t,e){this._popupImage.src=e,this._popupImage.alt=t,this._popupUndertext.textContent=t,super.open()}}(".popup_image-preview"),f=new class extends t{constructor(t){super(t),this._buttonConfirm=this._popup.querySelector(".popup__confirm-button"),this._setEventListeners()}open(t){super.open(),this._handleConfirm=t}_setEventListeners(){this._buttonConfirm.addEventListener("click",(()=>{this._handleConfirm(),this.close()}))}}(".popup__confirm");function E(t,e){return new a(t,e,u.getUserInfo()._id,(()=>{v.open(e.name,e.link)}),(t=>{f.open((()=>{t(),_.deleteCard(e._id)}))}),((t,s)=>{_.likeCard(e._id,t).then((t=>{s(t.likes)}))})).getCard()}_.getUserInfo().then((t=>{u.setUserInfo(t)})).then((()=>_.getInitialCards())).then((t=>{(h=new o({items:t.reverse(),renderer:t=>{var e=E("#card-container",t);h.addItem(e)}},".elements")).renderItems()})).catch((t=>{console.log(t)})),r.addEventListener("click",(()=>{p.open(u.getUserInfo())})),i.addEventListener("click",(()=>{m.open({})}))})();