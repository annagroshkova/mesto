(()=>{"use strict";class t{constructor(t){this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._closeBtn=this._popup.querySelector(".popup__close-button"),this.setEventListeners()}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._closeBtn.addEventListener("click",(()=>this.close())),this._popup.addEventListener("mousedown",(t=>{t.target.classList.contains("popup")&&this.close()}))}_handleEscClose(t){"Escape"===t.key&&this.close()}}class e extends t{constructor(t,e,r){super(t),this._formSubmitHandler=e,this._formValidator=r,this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector('button[type="submit"]')}open(t){super.open(),this._setInputValues(t),this._formValidator.resetValidation()}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent="Сохранение...",this._formSubmitHandler(this._getInputValues()).then((()=>{this.close()})).finally((()=>{this._submitButton.textContent="Сохранить"}))}))}_getInputValues(){var t=new FormData(this._form);return Object.fromEntries(t)}_setInputValues(t){Object.keys(t).forEach((e=>{var r=this._form.querySelector(`input[name="${e}"]`);r&&(r.value=t[e])}))}}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},i=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__avatar-edit-button");class l{constructor(t,e){this._obj=t,this._formElement=e,this.enableValidation()}enableValidation(){this._inputList=Array.from(this._formElement.querySelectorAll(this._obj.inputSelector)),this._buttonSubmit=this._formElement.querySelector(this._obj.submitButtonSelector),this._setEventListeners(),this._toggleButtonState()}resetValidation(){this._toggleButtonState(),this._inputList.forEach((t=>{this._hideInputError(t)}))}_setEventListeners(){this._formElement.addEventListener("submit",(t=>{t.preventDefault()})),this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._inputCheck(t)}))}))}_toggleButtonState(){this._inputList.forEach((t=>{this._hasInvalidInput(t)||""===t.value?(this._buttonSubmit.classList.add(this._obj.inactiveButtonClass),this._buttonSubmit.setAttribute("disabled","true")):(this._buttonSubmit.classList.remove(this._obj.inactiveButtonClass),this._buttonSubmit.removeAttribute("disabled"))}))}_showInputError(t,e){var r=this._formElement.querySelector(`.${t.id}-error`);t.classList.add(this._obj.inputErrorClass),r.textContent=e,r.classList.add(this._obj.errorClass)}_hideInputError(t){var e=this._formElement.querySelector(`.${t.id}-error`);t.classList.remove(this._obj.inputErrorClass),e.textContent="",e.classList.remove(this._obj.errorClass)}_checkInputValidity(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}_inputCheck(t){this._checkInputValidity(t),this._toggleButtonState()}_hasInvalidInput(t){return!t.validity.valid}}class u{constructor(t,e){var r=t.items,s=t.renderer;this._items=r,this._renderer=s,this._container=document.querySelector(e)}addItem(t){this._container.prepend(t)}renderItems(){this._items.forEach((t=>{this._renderer(t)}))}}class c{constructor(t,e,r,s,n,i){this._card=e,this._myId=r,this._handleCardClick=s,this._handleCardDelete=n,this._handleCardLike=i,this._cardElement=document.querySelector(t).content.querySelector(".element").cloneNode(!0),this._cardImage=this._cardElement.querySelector(".element__image"),this._cardImage.src=this._card.link,this._cardImage.alt=this._card.name,this._cardText=this._cardElement.querySelector(".element__text"),this._cardText.textContent=this._card.name,this._cardLikes=this._cardElement.querySelector(".element__likes-amount"),this._cardLikes.textContent=this._card.likes.length.toString(),this._likeButton=this._cardElement.querySelector(".element__like-button"),this._deleteButton=this._cardElement.querySelector(".element__trash-icon"),e.likes.some((t=>t._id===r))&&this._likeButton.classList.add("element__like-button_active"),r!==e.owner._id&&this._deleteButton.remove(),this._setEventListeners()}getCard(){return this._cardElement}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>{this._deleteCard()})),this._cardImage.addEventListener("click",(()=>{this._handleCardClick()}))}_toggleLike(){this._likeButton.classList.toggle("element__like-button_active");var t=this._card.likes.some((t=>t._id===this._myId));this._handleCardLike(!t,(t=>{this._card.likes=t,this._cardLikes.textContent=t.length.toString()}))}_deleteCard(){this._handleCardDelete((()=>{this._cardElement.remove()}))}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}var _,d=new class{constructor(t){this._options=t}_checkResponse(t){return t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)}_request(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(`${this._options.baseUrl}/${t}`,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({headers:this._options.headers},e)).then(this._checkResponse)}getInitialCards(){return this._request("cards")}getUserInfo(){return this._request("users/me")}patchUserInfo(t){return this._request("users/me",{method:"PATCH",body:JSON.stringify({name:t.name,about:t.about})})}patchAvatar(t){return this._request("users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:t})})}postNewCard(t,e){return this._request("cards",{method:"POST",body:JSON.stringify({name:t,link:e})})}deleteCard(t){return this._request(`cards/${t}`,{method:"DELETE"})}likeCard(t,e){return this._request(`cards/${t}/likes`,{method:e?"PUT":"DELETE"})}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-55",headers:{authorization:"5d6a4a95-3b77-4e4c-9a74-5ef0cb01a629","Content-Type":"application/json"}}),p=new e(".popup_edit-avatar",(t=>{var e=t.avatar;return d.patchAvatar(e).then((t=>{m.setUserInfo(t)})).catch((t=>console.error(t)))}),new l(n,document.forms["avatar-form"])),m=new class{constructor(t,e,r){this._nameElement=document.querySelector(t),this._aboutElement=document.querySelector(e),this._profileAvatar=document.querySelector(r)}getUserInfo(){return{name:this._nameElement.textContent,about:this._aboutElement.textContent,avatar:this._profileAvatar.src,_id:this._id}}setUserInfo(t){var e=t.name,r=t.about,s=t.avatar,n=t._id;this._nameElement.textContent=e,this._aboutElement.textContent=r,this._profileAvatar.src=s,this._id=n}}(".profile__name-text",".profile__description",".profile__avatar"),f=document.forms["profile-form"],b=document.forms["card-form"],v=new e(".popup_edit",(function(t){return d.patchUserInfo(t).then((t=>{m.setUserInfo(t)})).catch((t=>console.error(t)))}),new l(n,f)),y=new e(".popup_add",(function(t){return d.postNewCard(t["place-name"],t["image-link"]).then((t=>{_.addItem(C("#card-container",t))})).catch((t=>console.error(t)))}),new l(n,b)),E=new class extends t{constructor(t){super(t),this._popupImage=this._popup.querySelector(".popup__image"),this._popupUndertext=this._popup.querySelector(".popup__undertext")}open(t,e){this._popupImage.src=e,this._popupImage.alt=t,this._popupUndertext.textContent=t,super.open()}}(".popup_image-preview"),g=new class extends t{constructor(t){super(t),this._buttonConfirm=this._popup.querySelector(".popup__confirm-button"),this._setEventListeners()}open(t){super.open(),this._handleConfirm=t}_setEventListeners(){this._buttonConfirm.addEventListener("click",(()=>{this._handleConfirm()}))}}(".popup_confirm");function C(t,e){return new c(t,e,m.getUserInfo()._id,(()=>{E.open(e.name,e.link)}),(t=>{g.open((()=>{d.deleteCard(e._id).then((()=>{g.close(),t()})).catch((t=>console.error(t)))}))}),((t,r)=>{d.likeCard(e._id,t).then((t=>{r(t.likes)})).catch((t=>console.error(t)))})).getCard()}Promise.all([d.getUserInfo(),d.getInitialCards()]).then((t=>{var e,r,s=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var s,n,i=[],o=!0,a=!1;try{for(r=r.call(t);!(o=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);o=!0);}catch(t){a=!0,n=t}finally{try{o||null==r.return||r.return()}finally{if(a)throw n}}return i}}(e,r)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=s[0],i=s[1];m.setUserInfo(n),(_=new u({items:i.reverse(),renderer:t=>{var e=C("#card-container",t);_.addItem(e)}},".elements")).renderItems()})).catch((t=>console.error(t))),i.addEventListener("click",(()=>{v.open(m.getUserInfo())})),o.addEventListener("click",(()=>{y.open({})})),a.addEventListener("click",(()=>{p.open({avatar:""})}))})();